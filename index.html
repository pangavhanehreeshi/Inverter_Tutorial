<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hrishikesh Pangavhane">
<meta name="dcterms.date" content="2026-02-16">

<title>Analog Inverter Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0b3b9638000aa634054a1a0e4b24ad6b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="Analog Inverter Tutorial">
<meta name="citation_abstract" content="In ... general ...
">
<meta name="citation_author" content="Hrishikesh Pangavhane">
<meta name="citation_publication_date" content="2026-02-16">
<meta name="citation_cover_date" content="2026-02-16">
<meta name="citation_year" content="2026">
<meta name="citation_online_date" content="2026-02-16">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=VLSI design;,citation_author=Claudio Talarico;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://web02.gonzaga.edu/faculty/talarico/vlsi/vlsi.html;,citation_publisher=Website;">
<meta name="citation_reference" content="citation_title=Fundamentals of layout design for electronic circuits;,citation_author=Jens Lienig;,citation_author=Juergen Scheible;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_doi=10.1007/978-3-030-39284-0;,citation_isbn=9783030392840;">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Analog Inverter Tutorial</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Hrishikesh Pangavhane <a href="mailto:hpangavhane@stud.hs-bremen.de" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        <a href="https://www.hs-bremen.de">
                        Hochschule Bremen - City University of Applied Sciences (HSB)
                        </a>
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">February 16, 2026</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      <div class="quarto-alternate-formats"><div class="quarto-title-meta-heading">Other Formats</div><div class="quarto-title-meta-contents"><p><a href="ana_inv_tut.pdf"><i class="bi bi-file-pdf"></i>PDF</a></p></div></div></div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>In … general …</p>
      </div>
    </div>


    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#full-design-flow-using-iic-osic-tools" id="toc-full-design-flow-using-iic-osic-tools" class="nav-link" data-scroll-target="#full-design-flow-using-iic-osic-tools"><span class="header-section-number">2</span> Full design flow using IIC-OSIC tools</a>
  <ul class="collapse">
  <li><a href="#schematic-entry-using-xschem" id="toc-schematic-entry-using-xschem" class="nav-link" data-scroll-target="#schematic-entry-using-xschem"><span class="header-section-number">2.1</span> Schematic entry using Xschem</a></li>
  <li><a href="#simulation-using-ngspice" id="toc-simulation-using-ngspice" class="nav-link" data-scroll-target="#simulation-using-ngspice"><span class="header-section-number">2.2</span> Simulation using NgSpice</a></li>
  <li><a href="#output-results" id="toc-output-results" class="nav-link" data-scroll-target="#output-results"><span class="header-section-number">2.3</span> Output Results</a></li>
  <li><a href="#post-processing-and-simulation-using-python" id="toc-post-processing-and-simulation-using-python" class="nav-link" data-scroll-target="#post-processing-and-simulation-using-python"><span class="header-section-number">2.4</span> Post processing and simulation using python</a></li>
  <li><a href="#introduction-to-layout" id="toc-introduction-to-layout" class="nav-link" data-scroll-target="#introduction-to-layout"><span class="header-section-number">2.5</span> Introduction to Layout</a>
  <ul class="collapse">
  <li><a href="#designing-layout-using-klayout" id="toc-designing-layout-using-klayout" class="nav-link" data-scroll-target="#designing-layout-using-klayout"><span class="header-section-number">2.5.1</span> Designing Layout using Klayout</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#klayout-pex-kpex" id="toc-klayout-pex-kpex" class="nav-link" data-scroll-target="#klayout-pex-kpex"><span class="header-section-number">3</span> Klayout-PEX (KPEX)</a>
  <ul class="collapse">
  <li><a href="#why-do-we-need-pex" id="toc-why-do-we-need-pex" class="nav-link" data-scroll-target="#why-do-we-need-pex"><span class="header-section-number">3.1</span> Why Do We Need PEX?</a></li>
  <li><a href="#pex-using-klayout-pex-tool" id="toc-pex-using-klayout-pex-tool" class="nav-link" data-scroll-target="#pex-using-klayout-pex-tool"><span class="header-section-number">3.2</span> PEX using Klayout-PEX tool</a></li>
  <li><a href="#running-the-kpexmagic-engine" id="toc-running-the-kpexmagic-engine" class="nav-link" data-scroll-target="#running-the-kpexmagic-engine"><span class="header-section-number">3.3</span> Running the <code>KPEX/MAGIC</code> Engine</a>
  <ul class="collapse">
  <li><a href="#example-command" id="toc-example-command" class="nav-link" data-scroll-target="#example-command"><span class="header-section-number">3.3.1</span> Example Command</a></li>
  </ul></li>
  <li><a href="#post-layout-simulation." id="toc-post-layout-simulation." class="nav-link" data-scroll-target="#post-layout-simulation."><span class="header-section-number">3.4</span> Post layout simulation.</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">3.5</span> Results</a></li>
  </ul></li>
  <li><a href="#sec-xschem-commands" id="toc-sec-xschem-commands" class="nav-link" data-scroll-target="#sec-xschem-commands"><span class="header-section-number">4</span> Xschem Commands</a></li>
  <li><a href="#sec-ngspice-commands" id="toc-sec-ngspice-commands" class="nav-link" data-scroll-target="#sec-ngspice-commands"><span class="header-section-number">5</span> ngspice Commands</a>
  <ul class="collapse">
  <li><a href="#commands" id="toc-commands" class="nav-link" data-scroll-target="#commands"><span class="header-section-number">5.1</span> Commands</a></li>
  <li><a href="#options" id="toc-options" class="nav-link" data-scroll-target="#options"><span class="header-section-number">5.2</span> Options</a></li>
  <li><a href="#convergence-helper" id="toc-convergence-helper" class="nav-link" data-scroll-target="#convergence-helper"><span class="header-section-number">5.3</span> Convergence Helper</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="python\analog_inverter_sim-preview.html"><i class="bi bi-journal-code"></i>analog_inverter_sim.ipynb</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



  


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This tutorial provides a step-by-step introduction to designing and simulating a <strong>simple analog inverter</strong> using the <strong>open-source tools</strong> hosted on the <a href="https://github.com/iic-jku/IIC-OSIC-TOOLS">IIC-OSIC</a> platform, specifically with the <a href="https://github.com/IHP-GmbH/IHP-Open-PDK">IHP SG13G2 PDK</a>. The analog inverter, though simple, is a crucial element in analog and mixed-signal circuit design, offering valuable insights into device behavior, biasing, and small-signal performance. The goal of this tutorial is to prrovide a concise overview of the steps needed to create and verify simple CMOS circuits and systems.</p>
</section>
<section id="full-design-flow-using-iic-osic-tools" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Full design flow using IIC-OSIC tools</h1>
<section id="schematic-entry-using-xschem" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="schematic-entry-using-xschem"><span class="header-section-number">2.1</span> Schematic entry using Xschem</h2>
<p>Schematic entry is performed using <a href="https://xschem.sourceforge.io/stefan/xschem_man/xschem_man.html">Xschem</a>, a powerful open-source schematic editor well-suited for analog and mixed-signal circuit design. In this step, the analog inverter circuit is constructed by placing and connecting NMOS and PMOS transistors from the <strong>IHP SG13G2 PDK</strong> library. Xschem provides an intuitive interface for defining circuit topology, assigning device parameters like W/L ratios, and labeling nodes for simulation. Proper hierarchy and net labeling ensure compatibility with simulation and layout tools used later in the design flow.</p>
<ol type="1">
<li><p>Start terminal and run IIC-OSIC docker image</p></li>
<li><p>To select the PDK, use command <code>iic-pdk ihp-sg13g</code> refer <a href="#fig-select-pdk" class="quarto-xref">Figure&nbsp;11</a></p></li>
</ol>
<div id="fig-select-pdk" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-select-pdk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_choose_pdk.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Xschem Entry."><img src="./figures/_fig_choose_pdk.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-select-pdk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Xschem Entry.
</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li><p>Start xschem and create a new schematic. Name it as (Analog_Inverter.sch)</p></li>
<li><p>Using <code>Ctrl+i</code> insert symbol from the sg13g2 library for lv_nmos and lv_pmos where lv stands for low-voltage</p></li>
<li><p>customize the transistor’s dimensions (select the symbol, right click on it and edit its properties) refer <a href="#fig-edit-properties" class="quarto-xref">Figure&nbsp;2</a></p></li>
</ol>
<div id="fig-edit-properties" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-edit-properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_edit_properties.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Xschem Entry."><img src="./figures/_fig_edit_properties.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-edit-properties-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Xschem Entry.
</figcaption>
</figure>
</div>
<ol start="6" type="1">
<li><p>Place an input pin <code>ipin.sym</code> and an output pin <code>opin.sym</code> the symbols are available in the library <code>~/foss/tools/xschem/share/xschem/xschem_library/devices</code> label the name of the input and output pins (select the pin, right click on it and edit its properties)</p></li>
<li><p>To wire to components, <code>Ctrl+w</code></p></li>
<li><p>Once finished, save the schematic <code>Ctrl+Shift+S</code> See <a href="#fig-xschem-symbol" class="quarto-xref">Figure&nbsp;4</a></p></li>
</ol>
<div id="fig-xschem-entry" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xschem-entry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/Analog_Inverter_xschem.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: Xschem Entry."><img src="./figures/Analog_Inverter_xschem.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xschem-entry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Xschem Entry.
</figcaption>
</figure>
</div>
<ol start="9" type="1">
<li>For creating a symbol, <code>Symbol --&gt; Make symbol from schematic | Ctrl+L</code>. We can also edit the symbol by opening it in a new tab, see <a href="#fig-xschem-symbol" class="quarto-xref">Figure&nbsp;4</a></li>
</ol>
<div id="fig-xschem-symbol" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xschem-symbol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/Analog_Inverter_symbol.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;4: Xschem Symbol."><img src="./figures/Analog_Inverter_symbol.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xschem-symbol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Xschem Symbol.
</figcaption>
</figure>
</div>
<ol start="10" type="1">
<li>Now that we have created a symbol, we need to perform DC and Transient analysis using NgSpice.</li>
</ol>
</section>
<section id="simulation-using-ngspice" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="simulation-using-ngspice"><span class="header-section-number">2.2</span> Simulation using NgSpice</h2>
<p>To perform various analysis, we need to create simulation testbenches.</p>
<ol type="1">
<li>Open new tab in xschem <code>Ctrl+o</code>, insert the symbol for inverter (Analog_Inverter.sym) <code>Ctrl+i</code>. Design a testbench in xschem see <a href="#fig-tb-dc" class="quarto-xref">Figure&nbsp;5</a>.</li>
</ol>
<div id="fig-tb-dc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tb-dc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_testbench.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;5: Xschem Testbench."><img src="./figures/_fig_testbench.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tb-dc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Xschem Testbench.
</figcaption>
</figure>
</div>
<ol start="2" type="1">
<li>The spice directives <strong>MODELS1</strong> and <strong>NGSPICE1</strong> are code.sym instances with the attributes shown in <a href="#fig-NgSpice" class="quarto-xref">Figure&nbsp;6</a> and <a href="#fig-TT-Models" class="quarto-xref">Figure&nbsp;7</a></li>
</ol>
<div id="fig-NgSpice" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NgSpice-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_NgSpice.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;6: Xschem Testbench."><img src="./figures/_fig_NgSpice.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NgSpice-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Xschem Testbench.
</figcaption>
</figure>
</div>
<div id="fig-TT-Models" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-TT-Models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_TT_Models.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;7: Xschem TT Corner."><img src="./figures/_fig_TT_Models.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-TT-Models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Xschem TT Corner.
</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li>Click the <strong>Netlist</strong> button to create a netlist which will give us a <code>.spice</code> file and then click on <strong>Simulate</strong> button to run the simulation.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have used NgSpice interactive mode for the spice simulation see <a href="#fig-spice-mode" class="quarto-xref">Figure&nbsp;8</a>. We can also find other modes <code>Simulation --&gt; Configure simulator and tools</code></p>
</div>
</div>
<div id="fig-spice-mode" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spice-mode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_NgSpice_Mode.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;8: Simulator Mode"><img src="./figures/_fig_NgSpice_Mode.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spice-mode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Simulator Mode
</figcaption>
</figure>
</div>
</section>
<section id="output-results" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="output-results"><span class="header-section-number">2.3</span> Output Results</h2>
<p>Outputs of dc and transient analysis can be seen in</p>
<div id="fig-tb-dc1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tb-dc1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_tb_dc.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;9: DC Analysis"><img src="./figures/_fig_tb_dc.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tb-dc1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: DC Analysis
</figcaption>
</figure>
</div>
<div id="fig-tb-tran" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tb-tran-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_tb_tran.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;10: Transient Analysis"><img src="./figures/_fig_tb_tran.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tb-tran-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Transient Analysis
</figcaption>
</figure>
</div>
</section>
<section id="post-processing-and-simulation-using-python" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="post-processing-and-simulation-using-python"><span class="header-section-number">2.4</span> Post processing and simulation using python</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./figures/_fig_inverter_transient.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Transient Curver"><img src="./figures/_fig_inverter_transient.svg" class="img-fluid figure-img" alt="Transient Curver"></a></p>
<figcaption>Transient Curver</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./figures/_fig_inverter_dc_analysis.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="DC Charachteristics"><img src="./figures/_fig_inverter_dc_analysis.svg" class="img-fluid figure-img" alt="DC Charachteristics"></a></p>
<figcaption>DC Charachteristics</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./figures/_fig_inverter_vtc.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="VTC"><img src="./figures/_fig_inverter_vtc.svg" class="img-fluid figure-img" alt="VTC"></a></p>
<figcaption>VTC</figcaption>
</figure>
</div>
</section>
<section id="introduction-to-layout" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="introduction-to-layout"><span class="header-section-number">2.5</span> Introduction to Layout</h2>
<p>Layout is the physical representation of an integrated circuit, where circuit components such as transistors, interconnects, and vias are defined geometrically on various layers corresponding to materials used in fabrication. The layout must adhere strictly to design rules provided by the semiconductor foundry. We have two tools <strong>Magic</strong> and <strong>KLayout</strong> which enables layout design and verification. Magic being a long-standing tool favored for its tight integration with open-source flows, while KLayout offers powerful editing, scripting, and visualization capabilities, especially suited for hierarchical designs and PDKs such as SG13G2.</p>
<section id="designing-layout-using-klayout" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="designing-layout-using-klayout"><span class="header-section-number">2.5.1</span> Designing Layout using Klayout</h3>
<p>Layout design is performed using <a href="https://github.com/KLayout/klayout">KLayout</a>, an open-source layout viewer and editor for GDSII and OASIS files. Inverter layout can be built either <strong>manually from scratch or using parametric cells (P_Cells)</strong> from the IHP SG13G2 PDK, p_cells simplify device instantiation by allowing parameterized generation of transistors and other structures. KLayout supports precise layer control, design rule checking, and layout-versus-schematic (LVS) compatibility.</p>
<ol type="1">
<li><p>Start terminal and run IIC-OSIC docker image.</p></li>
<li><p>To select the PDK, use command <code>iic-pdk ihp-sg13g</code> refer <a href="#fig-select-pdk" class="quarto-xref">Figure&nbsp;11</a></p></li>
</ol>
<div id="fig-select-pdk" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-select-pdk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_choose_pdk.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;11: Technology Selection"><img src="./figures/_fig_choose_pdk.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-select-pdk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Technology Selection
</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This step is crucial as it sets the technology IHP-SG13G2 in the tools.</p>
</div>
</div>
<ol start="3" type="1">
<li>Start klayout amd refer <a href="#fig-klayout-start" class="quarto-xref">Figure&nbsp;12</a>. A new window of Klayout will open after the command.</li>
</ol>
<div id="fig-klayout-start" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-klayout-start-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_klayout_start.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Figure&nbsp;12: Klayout Launch."><img src="./figures/_fig_klayout_start.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-klayout-start-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Klayout Launch.
</figcaption>
</figure>
</div>
<ol start="4" type="1">
<li>To create new layout, Go to <code>Files &gt;&gt; New Layout</code>. New Layout Properties dialog box will appear, change <code>Top Cell from TOP to inv(inverter)</code> and leave the rest the same refer <a href="#fig-new-layout" class="quarto-xref">Figure&nbsp;13</a></li>
</ol>
<div id="fig-new-layout" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-new-layout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_setting.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Figure&nbsp;13: New Layout"><img src="./figures/_fig_setting.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-new-layout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: New Layout
</figcaption>
</figure>
</div>
<ol start="5" type="1">
<li>Now go to <code>Basic - Basic Layout Objects</code> on the left panel. Under <code>SG13_dev - IHP SG13G2 Pcells</code>, select an NMOS device and place it in the layout. <code>Press ESC</code> to exit placement mode. Repeat the process for the PMOS, placing it directly above the NMOS to follow standard inverter structure.</li>
</ol>
<div id="fig-p-cell" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p-cell-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_p_cell.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;14: Pcells"><img src="./figures/_fig_p_cell.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-p-cell-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Pcells
</figcaption>
</figure>
</div>
<ol start="6" type="1">
<li>On the right side, the layer list shows all available layers; bold entries indicate layers currently used in the layout. To view all layers from the full cell hierarchy, <code>click Display → Full Hierarchy | Press Shift + F</code>.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled" title="Tips">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tips
</div>
</div>
<div class="callout-body-container callout-body">
<p>To rotate a PCell, go to the <code>Edit tab &gt;&gt; Move</code>, select the PCell, then right-click. Use the mouse wheel to zoom in and out, and press the middle mouse button to pan the layout view.</p>
</div>
</div>
<ol start="7" type="1">
<li><code>Double-click on the PCell</code> to open its parameter editor. Set parameters like the width and length values to match those used in your <strong>Xschem schematic</strong>, then <code>click OK</code> to apply the changes refer <a href="#fig-pcell-para" class="quarto-xref">Figure&nbsp;15</a></li>
</ol>
<div id="fig-pcell-para" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pcell-para-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_pcell_parameters.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Figure&nbsp;15: Parameters Window"><img src="./figures/_fig_pcell_parameters.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pcell-para-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Parameters Window
</figcaption>
</figure>
</div>
<ol start="8" type="1">
<li><p>Use the keyboard arrow keys to align the NMOS directly below the PMOS. Connect the <strong>input</strong> by joining the gates of both transistors using the <code>polysilicon layer - GatPoly.drawing</code>. Connect the <strong>output</strong> by linking the source and drain of PMOS and NMOS with the <code>Metal1 layer - Metal1.drawing</code>. Similarly, use <code>Metal1.drawing</code> to connect the PMOS source to VCC and the NMOS source to VSS. Label all metal connections using the <code>Metal1 pin layer - Metal1.pin</code>. Refer to the <a href="https://ihp-open-pdk-docs.readthedocs.io/en/latest/layout_rules/02_layer_table.html#layer-table">IHP Open Source PDK DesignLIB</a> documentation to verify the correct layer numbers and purposes.</p></li>
<li><p>Finally, save your layout by going to <code>File → Save As</code>, and choose the <code>GDSII</code> format to export your design. Your completed CMOS inverter layout should resemble the image shown below.</p></li>
</ol>
<div id="fig-inv" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-inv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./figures/_fig_inverter.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;16: Final Layout"><img src="./figures/_fig_inverter.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Final Layout
</figcaption>
</figure>
</div>
<p><a href="https://github.com/IHP-GmbH/IHP-Open-PDK/blob/main/ihp-sg13g2/libs.doc/doc/SG13G2_os_layout_rules.pdf">Here</a> you can find all the layout rules in depth and with illustrations.</p>
</section>
</section>
</section>
<section id="klayout-pex-kpex" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Klayout-PEX (KPEX)</h1>
<p>While in the schematic, a connection between device terminals is seen as an equipotential, the stacked geometries in a specific layout introduce parasitic effects, which can be thought of additional resistors, capacitors (and inductors), not modeled by and missing in the original schematic.</p>
<p>To be able to simulate these effects, a parasitic extraction tool (PEX) is used, to extract a netlist from the layout, which represents the original schematic (created from the layout active and passive elements) augmented with the additional parasitic devices.</p>
<section id="why-do-we-need-pex" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="why-do-we-need-pex"><span class="header-section-number">3.1</span> Why Do We Need PEX?</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Reason</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Performance Degradation</strong></td>
<td>Parasitic capacitance reduces bandwidth and phase margin.</td>
</tr>
<tr class="even">
<td><strong>Offset and Mismatch Effects</strong></td>
<td>Parasitic coupling causes imbalance in differential paths.</td>
</tr>
<tr class="odd">
<td><strong>Stability Impact</strong></td>
<td>Additional phase lag from parasitics can destabilize feedback loops.</td>
</tr>
<tr class="even">
<td><strong>Post-Layout Verification</strong></td>
<td>Confirms that layout did not violate design intent (gain, UGB, PSRR, etc.).</td>
</tr>
<tr class="odd">
<td><strong>Tapeout Confidence</strong></td>
<td>Ensures high correlation between simulation and silicon behavior.</td>
</tr>
</tbody>
</table>
<p>IIC-OSIC-Tools offers <a href="https://martinjankoehler.github.io/klayout-pex-website/doc/doc.html">KPEX</a> for this purpose which is a tool, well integrated with Klayout by using its API.</p>
</section>
<section id="pex-using-klayout-pex-tool" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="pex-using-klayout-pex-tool"><span class="header-section-number">3.2</span> PEX using Klayout-PEX tool</h2>
<p>IIC-OSIC-Tools comes with pre-installed tool called as <strong>K-pex</strong>. The current status of <a href="https://martinjankoehler.github.io/klayout-pex-website/doc/doc.html#sec-into-klayout-pex-prototype-status">KLayout-PEX</a> says as following:</p>
<p>Available KLayout PEX Engines:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 17%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Engine</strong></th>
<th><strong>PEX Type</strong></th>
<th><strong>Status</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>KPEX/MAGIC</code></td>
<td>CC, RC</td>
<td>Usable</td>
<td>Wrapper engine, using installed <code>magic</code> tool</td>
</tr>
<tr class="even">
<td><code>KPEX/FasterCap</code></td>
<td>CC</td>
<td>Usable, <em>pending QA</em></td>
<td>Field solver engine using <code>FasterCap</code></td>
</tr>
<tr class="odd">
<td><code>KPEX/FastHenry2</code></td>
<td>R, L</td>
<td>Planned</td>
<td>Field solver engine using <code>FastHenry2</code></td>
</tr>
<tr class="even">
<td><code>KPEX/2.5D</code></td>
<td>CC</td>
<td>Under construction</td>
<td>Prototype engine implementing MAGIC concepts/formulas with <code>KLayout</code> means</td>
</tr>
<tr class="odd">
<td><code>KPEX/2.5D</code></td>
<td>R, RC</td>
<td>Planned</td>
<td>Prototype engine implementing MAGIC concepts/formulas with <code>KLayout</code> means</td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-kpexmagic-engine" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="running-the-kpexmagic-engine"><span class="header-section-number">3.3</span> Running the <code>KPEX/MAGIC</code> Engine</h2>
<p>The magic section of <code>kpex --help</code> describes the arguments and their defaults. Important arguments:</p>
<ul>
<li><code>--magicrc</code>: specify location of the <code>magicrc</code> file<br>
</li>
<li><code>--gds</code>: path to the GDS input layout<br>
</li>
<li><code>--magic</code>: enable magic engine</li>
<li><code>--out_dir</code> : set the output directory</li>
</ul>
<section id="example-command" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="example-command"><span class="header-section-number">3.3.1</span> Example Command</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kpex</span> <span class="at">--pdk</span> ihp_sg13g2 <span class="at">--magic</span> <span class="at">--gds</span> GDS_PATH <span class="at">--out_dir</span> OUTPUT_DIR_PATH</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>more to kpex can be found under the command <code>kpex --help</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/foss/designs</span> <span class="op">&gt;</span> kpex <span class="at">--help</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Usage:</span> kpex <span class="pp">[--</span><span class="ss">help</span><span class="pp">]</span> <span class="pp">[--</span><span class="ss">version</span><span class="pp">]</span> [--log_level LOG_LEVEL]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--threads</span> NUM_THREADS] <span class="at">--pdk</span> <span class="dt">{ihp_sg13g2</span><span class="op">,</span><span class="dt">sky130A}</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--out_dir</span> OUTPUT_DIR_BASE_PATH] [--gds GDS_PATH]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--schematic</span> SCHEMATIC_PATH] [--lvsdb LVSDB_PATH]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--cell</span> CELL_NAME] [--cache-lvs CACHE_LVS]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--cache-dir</span> CACHE_DIR_PATH] [--lvs-verbose KLAYOUT_LVS_VERBOSE]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--blackbox</span> BLACKBOX_DEVICES] <span class="pp">[--</span><span class="ss">fastercap</span><span class="pp">]</span> <span class="pp">[--</span><span class="ss">fastcap</span><span class="pp">]</span> <span class="pp">[--</span><span class="ss">magic</span><span class="pp">]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--2.5D]</span> [--k_void K_VOID] [--delaunay_amax DELAUNAY_AMAX]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--delaunay_b</span> DELAUNAY_B] [--geo_check GEOMETRY_CHECK]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--diel</span> DIELECTRIC_FILTER] [--tolerance FASTERCAP_TOLERANCE]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--d_coeff</span> FASTERCAP_D_COEFF]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--mesh</span> FASTERCAP_MESH_REFINEMENT_VALUE]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--ooc</span> FASTERCAP_OOC_CONDITION]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--auto_precond</span> FASTERCAP_AUTO_PRECONDITIONER] <span class="pp">[--</span><span class="ss">galerkin</span><span class="pp">]</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--jacobi]</span> [--magicrc MAGICRC_PATH] [--magic_mode <span class="dt">{CC</span><span class="op">,</span><span class="dt">RC</span><span class="op">,</span><span class="dt">R}</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--magic_cthresh</span> MAGIC_CTHRESH] [--magic_rthresh MAGIC_RTHRESH]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--magic_tolerance</span> MAGIC_TOLERANCE] [--magic_halo MAGIC_HALO]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--magic_short</span> <span class="dt">{none</span><span class="op">,</span><span class="dt">resistor</span><span class="op">,</span><span class="dt">voltage}</span>]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--magic_merge</span> <span class="dt">{none</span><span class="op">,</span><span class="dt">conservative</span><span class="op">,</span><span class="dt">aggressive}</span>] [--mode <span class="dt">{CC</span><span class="op">,</span><span class="dt">RC</span><span class="op">,</span><span class="dt">R}</span>]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="ex">[--halo</span> HALO] [--scale SCALE_RATIO_TO_FIT_HALO]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="ex">kpex:</span> KLayout-integrated Parasitic Extraction Tool</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="ex">Special</span> Options:</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--help,</span> <span class="at">-h</span>            show this help message and exit</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--version,</span> <span class="at">-v</span>         show program<span class="st">'s version number and exit</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="st">  --log_level LOG_LEVEL</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="st">                        log_level ∈ {'</span>all<span class="st">', '</span>debug<span class="st">', '</span>subprocess<span class="st">', '</span>verbose<span class="st">',</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="st">                        '</span>info<span class="st">', '</span>warning<span class="st">', '</span>error<span class="st">', '</span>critical<span class="st">'}. Defaults to</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="st">                        '</span>subprocess<span class="st">'</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="st">  --threads NUM_THREADS</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="st">                        number of threads (e.g. for FasterCap) (default is 48)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="st">Parasitic Extraction Setup:</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="st">  --pdk {ihp_sg13g2,sky130A}</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="st">                        pdk ∈ {'</span>ihp_sg13g2<span class="st">', '</span>sky130A<span class="st">'}</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="st">  --out_dir, -o OUTPUT_DIR_BASE_PATH</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="st">                        Output directory path (default is '</span>output<span class="st">')</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="st">Parasitic Extraction Input:</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="st">  Either LVS is run, or an existing LVSDB is used</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="st">  --gds, -g GDS_PATH    GDS path (for LVS)</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="st">  --schematic, -s SCHEMATIC_PATH</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="st">                        Schematic SPICE netlist path (for LVS). If none given,</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="st">                        a dummy schematic will be created</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="st">  --lvsdb, -l LVSDB_PATH</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="st">                        KLayout LVSDB path (bypass LVS)</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="st">  --cell, -c CELL_NAME  Cell (default is the top cell)</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="st">  --cache-lvs CACHE_LVS</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="st">                        Used cached LVSDB (for given input GDS) (default is</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="st">                        True)</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="st">  --cache-dir CACHE_DIR_PATH</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="st">                        Path for cached LVSDB (default is .kpex_cache within</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="st">                        --out_dir)</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="st">  --lvs-verbose KLAYOUT_LVS_VERBOSE</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="st">                        Verbose KLayout LVS output (default is False)</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="st">Parasitic Extraction Options:</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="st">  --blackbox BLACKBOX_DEVICES</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="st">                        Blackbox devices like MIM/MOM caps, as they are</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="st">                        handled by SPICE models (default is False for testing</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="st">                        now)</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="st">  --fastercap           Run FasterCap engine (default is False)</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="st">  --fastcap             Run FastCap2 engine (default is False)</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="st">  --magic               Run MAGIC engine (default is False)</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="st">  --2.5D                Run 2.5D analytical engine (default is False)</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="st">Fastercap Options:</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="st">  --k_void, -k K_VOID   Dielectric constant of void (default is 3.9)</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="st">  --delaunay_amax, -a DELAUNAY_AMAX</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="st">                        Delaunay triangulation maximum area (default is 50)</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="st">  --delaunay_b, -b DELAUNAY_B</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="st">                        Delaunay triangulation b (default is 0.5)</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="st">  --geo_check GEOMETRY_CHECK</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="st">                        Validate geometries before passing to FasterCap</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="st">                        (default is False)</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="st">  --diel DIELECTRIC_FILTER</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="st">                        Comma separated list of dielectric filter patterns.</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="st">                        Allowed patterns are: (none, all, -dielname1,</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="st">                        +dielname2) (default is all)</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="st">  --tolerance FASTERCAP_TOLERANCE</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="st">                        FasterCap -aX error tolerance (default is 0.05)</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="st">  --d_coeff FASTERCAP_D_COEFF</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="st">                        FasterCap -d direct potential interaction coefficient</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">                        to mesh refinement (default is 0.5)</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="st">  --mesh FASTERCAP_MESH_REFINEMENT_VALUE</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="st">                        FasterCap -m Mesh relative refinement value (default</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="st">                        is 0.5)</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="st">  --ooc FASTERCAP_OOC_CONDITION</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="st">                        FasterCap -f out-of-core free memory to link memory</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="st">                        condition (0 = don'</span>t go OOC, default is 2<span class="er">)</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--auto_precond</span> FASTERCAP_AUTO_PRECONDITIONER</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">FasterCap</span> <span class="at">-ap</span> Automatic preconditioner usage <span class="er">(</span><span class="ex">default</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">is</span> True<span class="kw">)</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--galerkin</span>            FasterCap <span class="at">-g</span> Use Galerkin scheme <span class="er">(</span><span class="ex">default</span> is False<span class="kw">)</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--jacobi</span>              FasterCap <span class="at">-pj</span> Use Jacobi preconditioner <span class="er">(</span><span class="ex">default</span> is</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">False</span><span class="kw">)</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="ex">Magic</span> Options:</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magicrc</span> MAGICRC_PATH</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Path</span> to magicrc configuration file <span class="er">(</span><span class="ex">default</span> is</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'/foss/pdks/ihp-sg13g2/libs.tech/magic/ihp-sg13g2.magi</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="st">                        crc'</span><span class="kw">)</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_mode</span> <span class="dt">{CC</span><span class="op">,</span><span class="dt">RC</span><span class="op">,</span><span class="dt">R}</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">magic_mode</span> ∈ {<span class="st">'CC'</span>, <span class="st">'RC'</span>, <span class="st">'R'</span>}. Defaults to <span class="st">'CC'</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_cthresh</span> MAGIC_CTHRESH</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Threshold</span> <span class="er">(in</span> <span class="ex">fF</span><span class="kw">)</span> <span class="cf">for</span> ignored <span class="ex">parasitic</span> capacitances</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">(</span><span class="ex">default</span> is 0.01<span class="kw">)</span><span class="bu">.</span> <span class="er">(</span><span class="ex">MAGIC</span> command: ext2spice cthresh</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&lt;</span>value<span class="op">&gt;</span><span class="kw">)</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_rthresh</span> MAGIC_RTHRESH</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Threshold</span> <span class="er">(in</span> <span class="ex">Ω</span><span class="kw">)</span> <span class="cf">for</span> ignored <span class="ex">parasitic</span> resistances</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">(</span><span class="ex">default</span> is 100<span class="kw">)</span><span class="bu">.</span> <span class="er">(</span><span class="ex">MAGIC</span> command: ext2spice rthresh</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&lt;</span>value<span class="op">&gt;</span><span class="kw">)</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_tolerance</span> MAGIC_TOLERANCE</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Set</span> ratio between resistor and device tolerance</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">(</span><span class="ex">default</span> is 1<span class="kw">)</span><span class="bu">.</span> <span class="er">(</span><span class="ex">MAGIC</span> command: extresist tolerance</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&lt;</span>value<span class="op">&gt;</span><span class="kw">)</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_halo</span> MAGIC_HALO</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Custom</span> sidewall halo distance <span class="er">(in</span> <span class="ex">µm</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">MAGIC</span> command:</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">extract</span> halo <span class="op">&lt;</span>value<span class="op">&gt;</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">default</span> is no custom halo<span class="kw">)</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_short</span> <span class="dt">{none</span><span class="op">,</span><span class="dt">resistor</span><span class="op">,</span><span class="dt">voltage}</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">magic_short</span> ∈ {<span class="st">'none'</span>, <span class="st">'resistor'</span>, <span class="st">'voltage'</span>}.</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Defaults</span> to <span class="st">'none'</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--magic_merge</span> <span class="dt">{none</span><span class="op">,</span><span class="dt">conservative</span><span class="op">,</span><span class="dt">aggressive}</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">magic_merge</span> ∈ {<span class="st">'none'</span>, <span class="st">'conservative'</span>, <span class="st">'aggressive'</span>}.</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Defaults</span> to <span class="st">'none'</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="ex">2.5D</span> Options:</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--mode</span> <span class="dt">{CC</span><span class="op">,</span><span class="dt">RC</span><span class="op">,</span><span class="dt">R}</span>      mode ∈ {<span class="st">'CC'</span>, <span class="st">'RC'</span>, <span class="st">'R'</span>}. Defaults to <span class="st">'CC'</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--halo</span> HALO           Custom sidewall halo distance <span class="er">(in</span> <span class="ex">µm</span><span class="kw">)</span> <span class="ex">to</span> override tech</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">info</span> <span class="er">(</span><span class="ex">default</span> is no custom halo<span class="kw">)</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--scale</span> SCALE_RATIO_TO_FIT_HALO</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>                        <span class="ex">Scale</span> fringe ratios, so that halo distance is 100%</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">(</span><span class="ex">default</span> is True<span class="kw">)</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="ex">Environmental</span> variables:</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Variable</span>             Description</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a> <span class="ex">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>  <span class="ex">KPEX_FASTCAP_EXE</span>     Path to FastCap2 Executable. Defaults to <span class="st">'fastcap'</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="ex">KPEX_FASTERCAP_EXE</span>   Path to FasterCap Executable. Defaults to <span class="st">'FasterCap'</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>  <span class="ex">KPEX_KLAYOUT_EXE</span>     Path to KLayout Executable. Defaults to <span class="st">'klayout'</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>  <span class="ex">KPEX_MAGIC_EXE</span>       Path to MAGIC Executable. Defaults to <span class="st">'magic'</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>  <span class="ex">PDKPATH</span>              Optional <span class="er">(</span><span class="ex">required</span> for default magicrc<span class="kw">)</span><span class="ex">,</span> e.g.</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>                       <span class="va">$HOME</span><span class="ex">/.volare</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>  <span class="ex">PDK</span>                  Optional <span class="er">(</span><span class="ex">required</span> for default magicrc<span class="kw">)</span><span class="ex">,</span> <span class="er">(</span><span class="ex">e.g.</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>                       <span class="ex">sky130A</span><span class="kw">)</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once PEX is succesfully done, the extracted netlist SPICE file will be generated in the provided output path, which consists of extracted parasitics which can be further used to do post layout simulations and verify whether the design layout satisfies the design specifications or not.</p>
<div id="fig-output-dir" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-output-dir-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/_fig_pex_outputdir.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;17: Extracted Spice file"><img src="figures/_fig_pex_outputdir.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-output-dir-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Extracted Spice file
</figcaption>
</figure>
</div>
</section>
</section>
<section id="post-layout-simulation." class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="post-layout-simulation."><span class="header-section-number">3.4</span> Post layout simulation.</h2>
<p>We have established testbenches for DC, AC, and transient analysis using the symbol of the designed inverter as a subcircuit. The next step is to perform post-layout simulation by replacing the schematic netlist with the extracted layout netlist (PEX), in order to verify whether the performance remains consistent after layout parasitics are included.</p>
<p>Firstly we need to open the symbol file in Xschem, edit the properties of the symbol See <a href="#fig-primitive" class="quarto-xref">Figure&nbsp;18</a>. Change from <code>subcircuit</code> to <code>primitive</code>.</p>
<div id="fig-primitive" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-primitive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/_fig_primitive.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21" title="Figure&nbsp;18: Primitive"><img src="figures/_fig_primitive.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-primitive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Primitive
</figcaption>
</figure>
</div>
<p>Once changed to primitive, now we can include the <code>.spice</code> file from PEX to the testbench. See <a href="#fig-include" class="quarto-xref">Figure&nbsp;19</a></p>
<div id="fig-include" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-include-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/_fig_include.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22" title="Figure&nbsp;19: Include"><img src="figures/_fig_include.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-include-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Include
</figcaption>
</figure>
</div>
</section>
<section id="results" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="results"><span class="header-section-number">3.5</span> Results</h2>
<div id="fig-result" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/_fig_pex_output.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23" title="Figure&nbsp;20: Result"><img src="figures/_fig_pex_output.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Result
</figcaption>
</figure>
</div>
<p><a href="#fig-result" class="quarto-xref">Figure&nbsp;20</a> shows that the response is as same as we expected from our schematic.</p>
</section>
</section>
<section id="sec-xschem-commands" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Xschem Commands</h1>
<p>Useful shortcuts are as follows</p>
<section id="moving-around-in-a-schematic" class="level4" data-number="4.0.0.1">
<h4 data-number="4.0.0.1" class="anchored" data-anchor-id="moving-around-in-a-schematic"><span class="header-section-number">4.0.0.1</span> Moving around in a schematic:</h4>
<ul>
<li><code>Cursor keys</code> to move around</li>
<li><code>Ctrl-e</code> to go back to parent schematic</li>
<li><code>e</code> to descend into schematic of selected symbol</li>
<li><code>i</code> to descend into symbol of selected symbol</li>
<li><code>f</code> full zoom on schematic</li>
<li><code>Shift-z</code> to zoom in</li>
<li><code>Ctrl-z</code> to zoom out</li>
</ul>
</section>
<section id="editing-schematics" class="level4" data-number="4.0.0.2">
<h4 data-number="4.0.0.2" class="anchored" data-anchor-id="editing-schematics"><span class="header-section-number">4.0.0.2</span> Editing schematics:</h4>
<ul>
<li><code>Del</code> to delete elements</li>
<li><code>Ins</code> to insert elements from library</li>
<li><code>Escape</code> to abort an operation</li>
<li><code>Ctrl-#</code> to rename components with duplicate names</li>
<li><code>c</code> to copy elements</li>
<li><code>Alt-Shift-l</code> to add wire label</li>
<li><code>Alt-l</code> to add label pin</li>
<li><code>m</code> to move selected objects</li>
<li><code>Shift-R</code> to rotate selected objects</li>
<li><code>Shift-F</code> to mirror / flip selected objects</li>
<li><code>q</code> to edit properties</li>
<li><code>Ctrl-s</code> to save schematic</li>
<li><code>t</code> to place a text</li>
<li><code>Shift-T</code> to toggle the <code>ignore</code> flag on an instance</li>
<li><code>u</code> to undo an operation</li>
<li><code>w</code> to draw a wire</li>
<li><code>Shift-W</code> draw wire and snap to close pin or net point</li>
<li><code>&amp;</code> to join, break, and collapse wires</li>
<li><code>A</code> to make symbol from schematic</li>
<li><code>Alt-s</code> to reload the circuit if changes in a subcircuit were made</li>
</ul>
</section>
<section id="viewingsimulating-schematics" class="level4" data-number="4.0.0.3">
<h4 data-number="4.0.0.3" class="anchored" data-anchor-id="viewingsimulating-schematics"><span class="header-section-number">4.0.0.3</span> Viewing/Simulating Schematics</h4>
<ul>
<li><code>5</code> to only view probes</li>
<li><code>k</code> to highlight selected net</li>
<li><code>Shift-K</code> to unhighlight all nets</li>
<li><code>Shift-o</code> to toggle light/dark color scheme</li>
<li><code>s</code> to run a simulation</li>
<li><code>a &amp; b</code> to add cursors to an in-circuit simulation graph</li>
<li><code>f</code> full zoom on y- or x-axis in in-circuit simulation graph</li>
</ul>
</section>
</section>
<section id="sec-ngspice-commands" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> ngspice Commands</h1>
<p>Useful shortcuts are as follows:</p>
<section id="commands" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="commands"><span class="header-section-number">5.1</span> Commands</h2>
<ul>
<li><code>ac dec|lin points fstart fstop</code> performs a small-signal ac analysis with either linear or decade sweep</li>
<li><code>dc sourcename vstart vstop vincr [src2 start2 stop2 incr2]</code> runs a dc-sweep, optionally across two variables</li>
<li><code>display</code> shows the available data vectors in the current plot</li>
<li><code>echo</code> can be used to display text, <code>$variable</code> or <code>$&amp;vector</code>, can be useful for debugging</li>
<li><code>let name = expr</code> to create a new vector; <code>unlet vector</code> deletes a specified vector; access vector data with <code>$&amp;vec</code></li>
<li><code>linearize vec</code> linearizes a vector on an equidistant time scale, do this before an FFT; with <code>set specwindow=windowtype</code> a proper windowing function can be set</li>
<li><code>meas</code> can be used for various evaluations of measurement results (see ngspice manual for details)</li>
<li><code>noise v(output &lt;ref&gt;) src (dec|lin) pts fstart fstop</code> runs a small-signal noise analysis</li>
<li><code>op</code> calculates the operating point, useful for checking bias points and device parameters</li>
<li><code>plot expr vs scale</code> to plot something</li>
<li><code>print expr</code> to print it, use <code>print all</code> to print everything</li>
<li><code>remzerovec</code> can be useful to remove vectors with zero length, which otherwise cause issues when saving or plotting data</li>
<li><code>rusage</code> plot information about resource usage like memory</li>
<li><code>save all</code> or <code>save signal</code> specifies which data is saved during simulation; this lowers RAM usage during simulation and size of RAW file; do save before the actual simulation statement</li>
<li><code>setplot</code> show a list of available plots</li>
<li><code>set var = value</code> to set the value of a variable; use variable with <code>$var</code>; <code>unset var</code> removes a variable</li>
<li><code>set enable_noisy_r</code> to enable noise of behavioral resistors; usually, this is a good idea</li>
<li><code>shell cmd</code> to run a shell command</li>
<li><code>show : param</code>, like <code>show : gm</code> shows the <span class="math inline">\(g_m\)</span> of all devices after running an operating point with <code>op</code></li>
<li><code>spec</code> plots a spectrum (i.e.&nbsp;frequency domain plot)</li>
<li><code>status</code> shows the saved parameters and nodes</li>
<li><code>tf</code> runs a transfer function analysis, returning transfer function, input and output resistance</li>
<li><code>tran tstep tstop &lt;tstart &lt;tmax&gt;&gt;</code> runs a transient analysis until <code>tstop</code>, reporting results with <code>tstep</code> step size, starting to plot at <code>tstart</code> and performs time steps not larger then <code>tmax</code></li>
<li><code>wrdata</code> writes data into a file in a tabular ASCII format; easy to further process</li>
<li><code>write</code> writes simulation data (the saved nodes) into a RAW file; default is binary, can be changed to ASCII with <code>set filetype=ascii</code>; with <code>set appendwrite</code> data is added to an existing file</li>
</ul>
</section>
<section id="options" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="options"><span class="header-section-number">5.2</span> Options</h2>
<p>Use <code>option option=val option=val</code> to set various options; important ones are:</p>
<ul>
<li><code>abstol</code> sets the absolute current error tolerance (default is 1pA)</li>
<li><code>gmin</code> is the conductance applied at every node for convergence improvement (default is 1e-12); this can be critical for very high impedance circuits</li>
<li><code>klu</code> sets the KLU matrix solver</li>
<li><code>list</code> print the summary listing of the input data</li>
<li><code>maxord</code> sets the numerical order of the integration method (default is 2 for Gear)</li>
<li><code>method</code> set the numerical integration method to <code>gear</code> or <code>trap</code> (default is <code>trap</code>)</li>
<li><code>node</code> prints the node table</li>
<li><code>opts</code> prints the option values</li>
<li><code>temp</code> sets the simulation temperature</li>
<li><code>reltol</code> set the relative error tolerance (default is 0.001 = 0.1%)</li>
<li><code>savecurrents</code> saves the terminal currents of all devices</li>
<li><code>sparse</code> sets the sparse matrix solver, which can run noise analysis, but is slower than <code>klu</code></li>
<li><code>vntol</code> sets the absolute voltage error tolerance (default is 1µV)</li>
<li><code>warn</code> enables the printing of the SOA warning messages</li>
</ul>
</section>
<section id="convergence-helper" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="convergence-helper"><span class="header-section-number">5.3</span> Convergence Helper</h2>
<ul>
<li><code>option gmin</code> can be used to increase the conductance applied at every node</li>
<li><code>option method=gear</code> can lead to improved convergence</li>
<li><code>.nodeset</code> can be used to specify initial node voltage guesses</li>
<li><code>.ic</code> can be used to set initial conditions</li>
</ul>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>Apache-2.0 license</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>